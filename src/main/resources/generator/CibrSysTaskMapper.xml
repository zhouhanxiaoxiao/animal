<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cibr.animal.demo.dao.CibrSysTaskMapper">
    <resultMap id="BaseResultMap" type="com.cibr.animal.demo.entity.CibrSysTask">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="tasktype" property="tasktype" jdbcType="VARCHAR"/>
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="createuser" property="createuser" jdbcType="VARCHAR"/>
        <result column="taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
        <result column="currentuser" property="currentuser" jdbcType="VARCHAR"/>
        <result column="handletime" property="handletime" jdbcType="TIMESTAMP"/>
        <result column="taskdesc" property="taskdesc" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="BaseResultMapask" type="com.cibr.animal.demo.entity.CibrSysTask">
        <id column="task_id" property="id" jdbcType="VARCHAR"/>
        <result column="task_tasktype" property="tasktype" jdbcType="VARCHAR"/>
        <result column="task_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="task_createuser" property="createuser" jdbcType="VARCHAR"/>
        <result column="task_taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
        <result column="task_currentuser" property="currentuser" jdbcType="VARCHAR"/>
        <result column="task_handletime" property="handletime" jdbcType="TIMESTAMP"/>
        <result column="task_taskdesc" property="taskdesc" jdbcType="VARCHAR"/>
        <association property="ask" javaType="com.cibr.animal.demo.entity.CibrTaskAskDrosophila">
            <id column="ctad_id" property="id" jdbcType="VARCHAR"/>
            <result column="ctad_creater" property="creater" jdbcType="VARCHAR"/>
            <result column="ctad_createtime" property="createtime" jdbcType="TIMESTAMP"/>
            <result column="ctad_remarks" property="remarks" jdbcType="VARCHAR"/>
            <result column="ctad_urgent" property="urgent" jdbcType="VARCHAR"/>
            <result column="ctad_taskid" property="taskid" jdbcType="VARCHAR"/>
            <result column="ctad_currentStatu" property="currentstatu" jdbcType="VARCHAR"/>
            <result column="ctad_currentHandler" property="currenthandler" jdbcType="VARCHAR"/>
        </association>
        <collection property="handler" ofType="com.cibr.animal.demo.entity.CibrSysUser">
            <id column="usr_ID" property="id" jdbcType="VARCHAR"/>
            <result column="usr_NAME" property="name" jdbcType="VARCHAR"/>
            <result column="usr_PASSWORD" property="password" jdbcType="VARCHAR"/>
            <result column="usr_EMAIL" property="email" jdbcType="VARCHAR"/>
            <result column="usr_ROLEID" property="roleid" jdbcType="VARCHAR"/>
            <result column="usr_USERDESC" property="userdesc" jdbcType="VARCHAR"/>
            <result column="usr_USERSTATU" property="userstatu" jdbcType="VARCHAR"/>
            <result column="usr_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>

    <resultMap id="BaseResultMappartner" type="com.cibr.animal.demo.entity.CibrSysTask">
        <id column="task_id" property="id" jdbcType="VARCHAR"/>
        <result column="task_tasktype" property="tasktype" jdbcType="VARCHAR"/>
        <result column="task_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="task_createuser" property="createuser" jdbcType="VARCHAR"/>
        <result column="task_taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
        <result column="task_currentuser" property="currentuser" jdbcType="VARCHAR"/>
        <result column="task_handletime" property="handletime" jdbcType="TIMESTAMP"/>
        <result column="task_taskdesc" property="taskdesc" jdbcType="VARCHAR"/>
        <association property="partner" javaType="com.cibr.animal.demo.entity.CibrTaskPartner">
            <id column="ctp_id" property="id" jdbcType="VARCHAR"/>
            <result column="ctp_taskId" property="taskid" jdbcType="VARCHAR"/>
            <result column="ctp_recordId" property="recordid" jdbcType="VARCHAR"/>
            <result column="ctp_creater" property="creater" jdbcType="VARCHAR"/>
            <result column="ctp_createTime" property="createtime" jdbcType="TIMESTAMP"/>
            <result column="ctp_remark" property="remark" jdbcType="VARCHAR"/>
            <result column="ctp_taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
        </association>
        <collection property="handler" ofType="com.cibr.animal.demo.entity.CibrSysUser">
            <id column="usr_ID" property="id" jdbcType="VARCHAR"/>
            <result column="usr_NAME" property="name" jdbcType="VARCHAR"/>
            <result column="usr_PASSWORD" property="password" jdbcType="VARCHAR"/>
            <result column="usr_EMAIL" property="email" jdbcType="VARCHAR"/>
            <result column="usr_ROLEID" property="roleid" jdbcType="VARCHAR"/>
            <result column="usr_USERDESC" property="userdesc" jdbcType="VARCHAR"/>
            <result column="usr_USERSTATU" property="userstatu" jdbcType="VARCHAR"/>
            <result column="usr_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>

    <resultMap id="BaseResultMapprocess" type="com.cibr.animal.demo.entity.CibrSysTask">
        <id column="task_id" property="id" jdbcType="VARCHAR"/>
        <result column="task_tasktype" property="tasktype" jdbcType="VARCHAR"/>
        <result column="task_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="task_createuser" property="createuser" jdbcType="VARCHAR"/>
        <result column="task_taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
        <result column="task_currentuser" property="currentuser" jdbcType="VARCHAR"/>
        <result column="task_handletime" property="handletime" jdbcType="TIMESTAMP"/>
        <result column="task_taskdesc" property="taskdesc" jdbcType="VARCHAR"/>
        <association property="process" javaType="com.cibr.animal.demo.entity.CibrTaskProcess">
            <id column="ctp_id" property="id" jdbcType="VARCHAR"/>
            <result column="ctp_taskid" property="taskid" jdbcType="VARCHAR"/>
            <result column="ctp_creater" property="creater" jdbcType="VARCHAR"/>
            <result column="ctp_createTime" property="createtime" jdbcType="TIMESTAMP"/>
            <result column="ctp_taskstatu" property="taskstatu" jdbcType="VARCHAR"/>
            <result column="ctp_projectName" property="projectname" jdbcType="VARCHAR"/>
            <result column="ctp_dataType" property="datatype" jdbcType="VARCHAR"/>
            <result column="ctp_principal" property="principal" jdbcType="VARCHAR"/>
            <result column="ctp_sampleType" property="sampletype" jdbcType="VARCHAR"/>
            <result column="ctp_sampleInput" property="sampleinput" jdbcType="VARCHAR"/>
            <result column="ctp_inputTime" property="inputtime" jdbcType="TIMESTAMP"/>
            <result column="ctp_samplePreparation" property="samplepreparation" jdbcType="VARCHAR"/>
            <result column="ctp_spupdateTime" property="spupdatetime" jdbcType="TIMESTAMP"/>
            <result column="ctp_libraryPreparation" property="librarypreparation" jdbcType="VARCHAR"/>
            <result column="ctp_lpupdateTime" property="lpupdatetime" jdbcType="TIMESTAMP"/>
            <result column="ctp_dismountData" property="dismountdata" jdbcType="VARCHAR"/>
            <result column="ctp_ddupdateTime" property="ddupdatetime" jdbcType="TIMESTAMP"/>
            <result column="ctp_bioinformaticsAnalysis" property="bioinformaticsanalysis" jdbcType="VARCHAR"/>
            <result column="ctp_baupdateTime" property="baupdatetime" jdbcType="TIMESTAMP"/>
            <result column="ctp_remarks" property="remarks" jdbcType="VARCHAR"/>
            <result column="ctp_isOnlyBio" property="isonlybio" jdbcType="VARCHAR"/>
        </association>
        <collection property="handler" ofType="com.cibr.animal.demo.entity.CibrSysUser">
            <id column="usr_ID" property="id" jdbcType="VARCHAR"/>
            <result column="usr_NAME" property="name" jdbcType="VARCHAR"/>
            <result column="usr_PASSWORD" property="password" jdbcType="VARCHAR"/>
            <result column="usr_EMAIL" property="email" jdbcType="VARCHAR"/>
            <result column="usr_ROLEID" property="roleid" jdbcType="VARCHAR"/>
            <result column="usr_USERDESC" property="userdesc" jdbcType="VARCHAR"/>
            <result column="usr_USERSTATU" property="userstatu" jdbcType="VARCHAR"/>
            <result column="usr_createtime" property="createtime" jdbcType="TIMESTAMP"/>
        </collection>
    </resultMap>

    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" suffix=")" prefixOverrides="and">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")"
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, tasktype, createtime, createuser, taskstatu, currentuser, handletime, taskdesc
    </sql>
    <select id="selectByExample" resultMap="BaseResultMap"
            parameterType="com.cibr.animal.demo.entity.CibrSysTaskExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from cibr_sys_task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from cibr_sys_task
        where id = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from cibr_sys_task
        where id = #{id,jdbcType=VARCHAR}
    </delete>
    <delete id="deleteByExample" parameterType="com.cibr.animal.demo.entity.CibrSysTaskExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from cibr_sys_task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.cibr.animal.demo.entity.CibrSysTask">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into cibr_sys_task (id, tasktype, createtime,
        createuser, taskstatu, currentuser,
        handletime, taskdesc)
        values (#{id,jdbcType=VARCHAR}, #{tasktype,jdbcType=VARCHAR}, #{createtime,jdbcType=TIMESTAMP},
        #{createuser,jdbcType=VARCHAR}, #{taskstatu,jdbcType=VARCHAR}, #{currentuser,jdbcType=VARCHAR},
        #{handletime,jdbcType=TIMESTAMP}, #{taskdesc,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.cibr.animal.demo.entity.CibrSysTask">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into cibr_sys_task
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="tasktype != null">
                tasktype,
            </if>
            <if test="createtime != null">
                createtime,
            </if>
            <if test="createuser != null">
                createuser,
            </if>
            <if test="taskstatu != null">
                taskstatu,
            </if>
            <if test="currentuser != null">
                currentuser,
            </if>
            <if test="handletime != null">
                handletime,
            </if>
            <if test="taskdesc != null">
                taskdesc,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="tasktype != null">
                #{tasktype,jdbcType=VARCHAR},
            </if>
            <if test="createtime != null">
                #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="createuser != null">
                #{createuser,jdbcType=VARCHAR},
            </if>
            <if test="taskstatu != null">
                #{taskstatu,jdbcType=VARCHAR},
            </if>
            <if test="currentuser != null">
                #{currentuser,jdbcType=VARCHAR},
            </if>
            <if test="handletime != null">
                #{handletime,jdbcType=TIMESTAMP},
            </if>
            <if test="taskdesc != null">
                #{taskdesc,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.cibr.animal.demo.entity.CibrSysTaskExample"
            resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from cibr_sys_task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update cibr_sys_task
        <set>
            <if test="record.id != null">
                id = #{record.id,jdbcType=VARCHAR},
            </if>
            <if test="record.tasktype != null">
                tasktype = #{record.tasktype,jdbcType=VARCHAR},
            </if>
            <if test="record.createtime != null">
                createtime = #{record.createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.createuser != null">
                createuser = #{record.createuser,jdbcType=VARCHAR},
            </if>
            <if test="record.taskstatu != null">
                taskstatu = #{record.taskstatu,jdbcType=VARCHAR},
            </if>
            <if test="record.currentuser != null">
                currentuser = #{record.currentuser,jdbcType=VARCHAR},
            </if>
            <if test="record.handletime != null">
                handletime = #{record.handletime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.taskdesc != null">
                taskdesc = #{record.taskdesc,jdbcType=VARCHAR},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update cibr_sys_task
        set id = #{record.id,jdbcType=VARCHAR},
        tasktype = #{record.tasktype,jdbcType=VARCHAR},
        createtime = #{record.createtime,jdbcType=TIMESTAMP},
        createuser = #{record.createuser,jdbcType=VARCHAR},
        taskstatu = #{record.taskstatu,jdbcType=VARCHAR},
        currentuser = #{record.currentuser,jdbcType=VARCHAR},
        handletime = #{record.handletime,jdbcType=TIMESTAMP},
        taskdesc = #{record.taskdesc,jdbcType=VARCHAR}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.cibr.animal.demo.entity.CibrSysTask">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update cibr_sys_task
        <set>
            <if test="tasktype != null">
                tasktype = #{tasktype,jdbcType=VARCHAR},
            </if>
            <if test="createtime != null">
                createtime = #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="createuser != null">
                createuser = #{createuser,jdbcType=VARCHAR},
            </if>
            <if test="taskstatu != null">
                taskstatu = #{taskstatu,jdbcType=VARCHAR},
            </if>
            <if test="currentuser != null">
                currentuser = #{currentuser,jdbcType=VARCHAR},
            </if>
            <if test="handletime != null">
                handletime = #{handletime,jdbcType=TIMESTAMP},
            </if>
            <if test="taskdesc != null">
                taskdesc = #{taskdesc,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.cibr.animal.demo.entity.CibrSysTask">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update cibr_sys_task
        set tasktype = #{tasktype,jdbcType=VARCHAR},
        createtime = #{createtime,jdbcType=TIMESTAMP},
        createuser = #{createuser,jdbcType=VARCHAR},
        taskstatu = #{taskstatu,jdbcType=VARCHAR},
        currentuser = #{currentuser,jdbcType=VARCHAR},
        handletime = #{handletime,jdbcType=TIMESTAMP},
        taskdesc = #{taskdesc,jdbcType=VARCHAR}
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <select id="selectByLimit" parameterType="Map" resultType="com.cibr.animal.demo.entity.CibrSysTask">
        select
        <include refid="Base_Column_List"/>
        from cibr_sys_task task
        where 1=1
        <if test="condition.userId != null">
            and (createuser = '${condition.userId}' or currentuser = '${condition.userId}')
        </if>
        order by taskstatu asc ,createtime desc
        <if test="condition.pageSize != null">
            limit ${condition.start},${condition.pageSize}
        </if>
    </select>
    <select id="selectCount" parameterType="Map" resultType="java.lang.Integer">
        select
        count(*)
        from cibr_sys_task
        where 1=1
        <if test="condition.userId != null">
            and (createuser = '${condition.userId}' or currentuser = '${condition.userId}')
        </if>
        <if test="condition.taskstatu != null">
            and taskstatu = '${condition.taskstatu}'
        </if>
    </select>

    <update id="batchUpdate" parameterType="java.util.List">
        <foreach collection="list" item="record" index="index" open="" close="" separator=";">
            update cibr_sys_task
            set tasktype = #{record.tasktype,jdbcType=VARCHAR},
            createtime = #{record.createtime,jdbcType=TIMESTAMP},
            createuser = #{record.createuser,jdbcType=VARCHAR},
            taskstatu = #{record.taskstatu,jdbcType=VARCHAR},
            currentuser = #{record.currentuser,jdbcType=VARCHAR},
            handletime = #{record.handletime,jdbcType=TIMESTAMP},
            taskdesc = #{record.taskdesc,jdbcType=VARCHAR}
            where id = #{record.id,jdbcType=VARCHAR}
        </foreach>
    </update>

    <select id="selectAskTask" resultMap="BaseResultMapask">
        select distinct
        task.id as task_id,
        task.tasktype as task_tasktype,
        task.createtime as task_createtime,
        task.createuser as task_createuser,
        task.taskstatu as task_taskstatu,
        task.currentuser as task_currentuser,
        task.handletime as task_handletime,
        task.taskdesc as task_taskdesc,
        ctad.id as ctad_id,
        ctad.creater as ctad_creater,
        ctad.createtime as ctad_createtime,
        ctad.remarks as ctad_remarks,
        ctad.urgent as ctad_urgent,
        ctad.taskid as ctad_taskid,
        ctad.currentStatu as ctad_currentStatu,
        ctad.currentHandler as ctad_currentHandler,
        usr.ID as usr_ID,
        usr.NAME as usr_NAME,
        usr.PASSWORD as usr_PASSWORD,
        usr.EMAIL as usr_EMAIL,
        usr.ROLEID as usr_ROLEID,
        usr.USERDESC as usr_USERDESC,
        usr.USERSTATU as usr_USERSTATU,
        usr.createtime as usr_createtime
        from cibr_sys_task task
        left join cibr_task_ask_drosophila ctad on task.id = ctad.taskid
        left join cibr_sys_user csu on (task.createuser = csu.ID or task.currentuser = csu.ID)
        left join cibr_sys_user usr on task.currentuser = usr.ID
        where 1=1
        <if test="flag == 'mytask'">
            and csu.ID = '${userId}'
        </if>
        and task.taskstatu != '09'
        and task.tasktype = '02';
    </select>

    <select id="selectPartnerTask" resultMap="BaseResultMappartner">
        select distinct
        task.id as task_id,
        task.tasktype as task_tasktype,
        task.createtime as task_createtime,
        task.createuser as task_createuser,
        task.taskstatu as task_taskstatu,
        task.currentuser as task_currentuser,
        task.handletime as task_handletime,
        task.taskdesc as task_taskdesc,
        ctp.id as ctp_id,
        ctp.taskId as ctp_taskId,
        ctp.recordId as ctp_recordId,
        ctp.creater as ctp_creater,
        ctp.createTime as ctp_createTime,
        ctp.remark as ctp_remark,
        ctp.taskstatu as ctp_taskstatu,
        usr.ID as usr_ID,
        usr.NAME as usr_NAME,
        usr.PASSWORD as usr_PASSWORD,
        usr.EMAIL as usr_EMAIL,
        usr.ROLEID as usr_ROLEID,
        usr.USERDESC as usr_USERDESC,
        usr.USERSTATU as usr_USERSTATU,
        usr.createtime as usr_createtime
        from cibr_sys_task task
        left join cibr_task_partner ctp
        on task.id = ctp.id
        left join cibr_sys_user csu on (task.currentuser = csu.ID or task.createuser = csu.ID)
        left join cibr_sys_user usr on task.currentuser = usr.ID
        where 1=1
        <if test="flag == 'mytask'">
            and csu.ID = '${userId}'
        </if>
        and task.taskstatu != '09'
        and task.tasktype = '04';
    </select>

    <select id="selectAllAccountTask" resultType="com.cibr.animal.demo.entity.CibrSysTask">
        select *
        from cibr_sys_task task
        where 1 = 1
          and task.tasktype = '01'
          and task.taskstatu = '01'
          and (
                exists(
                        select 1
                        from cibr_sys_user user
                        where user.ID = task.createuser
                          and user.ID = '${userId}'
                    )
                or exists(
                        select 1
                        from cibr_sys_user user,
                             cibr_sys_user cur,
                             cibr_sys_user_role userrole,
                             cibr_sys_role role
                        where user.ID = task.createuser
                          and cur.ID = '${userId}'
                          and cur.ROLEID = user.ROLEID
                          and userrole.userid = cur.ID
                          and userrole.roleid = role.id
                          and (role.roleType = '40' or role.roleType = '999999')
                    )
            )
    </select>

    <select id="selectProcessTask" resultMap="BaseResultMapprocess">
        select task.id                    as task_id,
               task.tasktype              as task_tasktype,
               task.createtime            as task_createtime,
               task.createuser            as task_createuser,
               task.taskstatu             as task_taskstatu,
               task.currentuser           as task_currentuser,
               task.handletime            as task_handletime,
               task.taskdesc              as task_taskdesc,
               ctp.id                     as ctp_id,
               ctp.taskid                 as ctp_taskid,
               ctp.creater                as ctp_creater,
               ctp.createTime             as ctp_createTime,
               ctp.taskstatu              as ctp_taskstatu,
               ctp.projectName            as ctp_projectName,
               ctp.dataType               as ctp_dataType,
               ctp.principal              as ctp_principal,
               ctp.sampleType             as ctp_sampleType,
               ctp.sampleInput            as ctp_sampleInput,
               ctp.inputTime              as ctp_inputTime,
               ctp.samplePreparation      as ctp_samplePreparation,
               ctp.spupdateTime           as ctp_spupdateTime,
               ctp.libraryPreparation     as ctp_libraryPreparation,
               ctp.lpupdateTime           as ctp_lpupdateTime,
               ctp.dismountData           as ctp_dismountData,
               ctp.ddupdateTime           as ctp_ddupdateTime,
               ctp.bioinformaticsAnalysis as ctp_bioinformaticsAnalysis,
               ctp.baupdateTime           as ctp_baupdateTime,
               ctp.remarks                as ctp_remarks,
               ctp.isOnlyBio              as ctp_isOnlyBio,
               usr.ID                     as usr_ID,
               usr.NAME                   as usr_NAME,
               usr.PASSWORD               as usr_PASSWORD,
               usr.EMAIL                  as usr_EMAIL,
               usr.ROLEID                 as usr_ROLEID,
               usr.USERDESC               as usr_USERDESC,
               usr.USERSTATU              as usr_USERSTATU,
               usr.createtime             as usr_createtime
        from cibr_sys_task task
                 left join cibr_task_process ctp on task.id = ctp.taskid
                 left join cibr_sys_user usr on usr.ID in
                                                (ctp.sampleInput, ctp.samplePreparation, ctp.libraryPreparation,
                                                 ctp.dismountData, ctp.bioinformaticsAnalysis)
        where task.tasktype = '03'
          and task.taskstatu != '09'
          and (
                task.createuser = '${userId}'
                or task.currentuser = '${userId}'
                or ctp.sampleInput = '${userId}'
                or ctp.samplePreparation = '${userId}'
                or ctp.libraryPreparation = '${userId}'
                or ctp.dismountData = '${userId}'
                or ctp.bioinformaticsAnalysis = '${userId}'
                or exists(
                        select 1
                        from cibr_sys_user subuser
                                 left join cibr_sys_user_role ur on subuser.id = ur.userid
                                 left join cibr_sys_role subrole on ur.roleid = subrole.id
                        where subrole.roleType = '999999'
                          and subuser.ID = '${userId}'
                    )
                or exists(
                        select 1
                        from cibr_sys_user aduser
                                 left join cibr_sys_user_role ur on aduser.id = ur.userid
                                 left join cibr_sys_role subrole on ur.roleid = subrole.id
                                 left join cibr_sys_user_group gp on gp.id = aduser.ROLEID
                        where aduser.ID = '${userId}'
                          and gp.groupname = '基因组学中心'
                          and subrole.roleType = '40'
                    )
                or exists(
                        select 1
                        from cibr_sys_user_group gro,
                             cibr_sys_user usr
                        where usr.ID = task.createuser
                          and usr.ROLEID = gro.id
                          and gro.groupadmin = '${userId}'
                    )
                or exists(
                        select 1
                        from cibr_sys_user userCre,
                             cibr_sys_user userNow,
                             cibr_sys_user_role userRole,
                             cibr_sys_role role
                        where userCre.ID = task.createuser
                          and userNow.ID = '${userId}'
                          and userCre.ROLEID = userNow.ROLEID
                          and userNow.ID = userRole.userid
                          and userRole.roleid = role.id
                          and role.roleType = '40'
                    )
                or exists(
                        select 1
                        from cibr_task_share share
                        where share.taskid = task.id
                          and share.shareUser = '${userId}'
                    )
            );
    </select>
    <select id="findUserTaskCount" resultType="java.util.Map">
        select A.name as name, count(A.taskId) as count
        from (
                 select user.name as name, task.id as taskId
                 from cibr_sys_user user
                          left join cibr_task_process proc
                                    on (
                                            proc.sampleInput = user.ID
                                            or proc.samplePreparation = user.ID
                                            or proc.libraryPreparation = user.ID
                                            or proc.dismountData = user.ID
                                            or proc.bioinformaticsAnalysis = user.ID
                                            or proc.creater = user.ID)
                          left join cibr_sys_task task
                                    on proc.taskid = task.id and task.taskstatu = '01' and tasktype = '03'
             ) A
        group by A.name
        order by count desc
        limit 10;
    </select>

    <select id="findAnimalTaskCount" resultType="java.util.Map">
        select user.NAME as name,count(task.id) as value
        from cibr_sys_user user
            left join cibr_sys_task task
            on task.createuser=user.ID
            and task.taskstatu in ('01','02','03')
            and task.tasktype in ('02','04')
        group by user.NAME
        order by count(task.id)
    </select>
</mapper>